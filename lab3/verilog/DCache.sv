// Generated by CIRCT firtool-1.62.0
// external module blk_mem_gen_1

module DCache(
  input          cpu_clk,
                 cpu_rst,
  input  [31:0]  data_addr,
  input  [3:0]   data_ren,
  output [31:0]  data_rdata,
  output         data_valid,
  input  [3:0]   data_wen,
  input  [31:0]  data_wdata,
  output         data_wresp,
  input          dev_wrdy,
  output [3:0]   dev_wen,
  output [31:0]  dev_waddr,
                 dev_wdata,
  input          dev_rrdy,
  output [3:0]   dev_ren,
  output [31:0]  dev_raddr,
  input          dev_rvalid,
  input  [127:0] dev_rdata,
  output         hit_r,
                 hit_w
);

  wire [127:0]     _U_dsram_douta;
  wire [127:0]     _tagSram_douta;
  wire             uncached =
    (&(data_addr[31:16])) & ((|data_ren) | (|data_wen));
  wire             _GEN = uncached & (|data_wen);
  wire [3:0]       _GEN_0 = _GEN ? data_wen : 4'h0;
  reg  [1:0]       state_w;
  reg  [1:0]       ofst;
  reg  [1:0]       hit_w_REG;
  reg  [1:0]       hit_w_REG_1;
  reg  [1:0]       hit_w_REG_2;
  wire             _GEN_1 = state_w == 2'h1;
  wire             _GEN_2 = _tagSram_douta[24:0] == {1'h1, data_addr[31:8]};
  wire             _GEN_3 = state_w == 2'h2;
  wire             _GEN_4 = ~(|state_w) | _GEN_1;
  wire [3:0]       _GEN_5 =
    (|state_w)
      ? (_GEN_1
           ? (_GEN_2 | _tagSram_douta[25] ? data_ren : 4'hF)
           : _GEN_3 & (&ofst) ? 4'hF : data_ren)
      : data_ren;
  wire [29:0]      _GEN_6 = _GEN_1 ? data_addr[31:2] : data_addr[31:2];
  wire             _GEN_7 = _GEN_4 | ~_GEN_3 | (&ofst) | ~dev_wrdy;
  wire [3:0][31:0] _GEN_8 =
    {{_U_dsram_douta[127:96]},
     {_U_dsram_douta[95:64]},
     {_U_dsram_douta[63:32]},
     {_U_dsram_douta[31:0]}};
  reg  [1:0]       state_r;
  reg  [1:0]       ofst_1;
  reg  [1:0]       hit_r_REG;
  reg  [1:0]       hit_r_REG_1;
  reg  [1:0]       hit_r_REG_2;
  wire             _GEN_9 = state_r == 2'h1;
  wire             _GEN_10 = _tagSram_douta[24:0] == {1'h1, data_addr[31:8]};
  wire             _GEN_11 = (|state_r) & _GEN_9 & _GEN_10;
  wire             _GEN_12 = _GEN_10 | _tagSram_douta[25];
  wire             _GEN_13 = state_r == 2'h2;
  wire             _GEN_14 = ~(|state_r) | _GEN_9;
  wire             _GEN_15 = _GEN_13 & (&ofst_1);
  wire             _GEN_16 = _GEN_14 | ~_GEN_13 | (&ofst_1);
  wire             _GEN_17 = (&state_r) & dev_rvalid;
  wire             _GEN_18 = ~(|state_r) | _GEN_9 | _GEN_13;
  wire             _GEN_19 =
    ~_GEN_18 & _GEN_17 | (|state_w)
    & (_GEN_1 ? _GEN_2 : ~_GEN_3 & (&state_w) & dev_rvalid);
  always @(posedge cpu_clk) begin
    if (cpu_rst) begin
      state_w <= 2'h0;
      ofst <= 2'h0;
      state_r <= 2'h0;
      ofst_1 <= 2'h0;
    end
    else begin
      automatic logic [1:0] _GEN_20;
      _GEN_20 = {1'h1, ~(_tagSram_douta[25])};
      if (|state_w) begin
        if (_GEN_1)
          state_w <= _GEN_2 ? 2'h0 : _GEN_20;
        else if (_GEN_3) begin
          if (&ofst)
            state_w <= 2'h3;
        end
        else if ((&state_w) & dev_rvalid)
          state_w <= 2'h1;
      end
      else if (~uncached & (|data_wen))
        state_w <= 2'h1;
      if (_GEN_4 | ~_GEN_3) begin
      end
      else
        ofst <= ofst + 2'h1;
      if (|state_r) begin
        if (_GEN_9)
          state_r <= _GEN_10 ? 2'h0 : _GEN_20;
        else if (_GEN_13) begin
          if (&ofst_1)
            state_r <= 2'h3;
        end
        else if (_GEN_17)
          state_r <= 2'h1;
      end
      else if (~uncached & (|data_ren))
        state_r <= 2'h1;
      if (_GEN_14 | ~_GEN_13) begin
      end
      else
        ofst_1 <= ofst_1 + 2'h1;
    end
    hit_w_REG <= state_w;
    hit_w_REG_1 <= state_w;
    hit_w_REG_2 <= hit_w_REG_1;
    hit_r_REG <= state_r;
    hit_r_REG_1 <= state_r;
    hit_r_REG_2 <= hit_r_REG_1;
  end // always @(posedge)
  blk_mem_gen_1 tagSram (
    .clka  (cpu_clk),
    .wea   (_GEN_19),
    .addra (data_addr[7:2]),
    .dina  ({_GEN_18 | ~_GEN_17 ? {102'h0, _GEN_1, 1'h1} : 104'h1, data_addr[31:8]}),
    .douta (_tagSram_douta)
  );
  blk_mem_gen_1 U_dsram (
    .clka  (cpu_clk),
    .wea   (_GEN_19),
    .addra (data_addr[7:2]),
    .dina  (dev_rdata),
    .douta (_U_dsram_douta)
  );
  assign data_rdata = _GEN_11 ? _GEN_8[data_addr[1:0]] : dev_rdata[31:0];
  assign data_valid =
    _GEN_11 | uncached & (|data_ren) & dev_rrdy & dev_rvalid;
  assign data_wresp = (|state_w) & _GEN_1 & _GEN_2 | _GEN & dev_wrdy;
  assign dev_wen = _GEN_16 ? (_GEN_7 ? _GEN_0 : 4'hF) : dev_wrdy ? 4'hF : _GEN_0;
  assign dev_waddr =
    _GEN_16
      ? (_GEN_7 ? data_addr : {_tagSram_douta[23:0], data_addr[7:2], ofst})
      : dev_wrdy ? {_tagSram_douta[23:0], data_addr[7:2], ofst_1} : data_addr;
  assign dev_wdata =
    _GEN_16
      ? (_GEN_7 ? data_wdata : _GEN_8[ofst])
      : dev_wrdy ? _GEN_8[ofst_1] : data_wdata;
  assign dev_ren =
    (|state_r) ? (_GEN_9 ? (_GEN_12 ? _GEN_5 : 4'hF) : _GEN_15 ? 4'hF : _GEN_5) : _GEN_5;
  assign dev_raddr =
    {(|state_r)
       ? (_GEN_9
            ? (_GEN_12 ? _GEN_6 : data_addr[31:2])
            : _GEN_15 ? data_addr[31:2] : _GEN_6)
       : _GEN_6,
     2'h0};
  assign hit_r = ~(|state_r) & hit_r_REG == 2'h1 & hit_r_REG_2 != 2'h3;
  assign hit_w = ~(|state_w) & hit_w_REG == 2'h1 & hit_w_REG_2 != 2'h3;
endmodule

